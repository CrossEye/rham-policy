/*\
title: $:/_/rham/macros/cgs.js
type: application/javascript
module-type: macro

Macro to return a link to a section in the Connecticut General Statutes

\*/
(function(){

/*jslint node: true, browser: true */
/*global $tw: false */
"use strict";

// source: http://link.sauyet.com/134
const chapters = `C|1|1-3b  C|2|1-6  C|3|1-21l  C|4|1-25  C|5|1-27  C|6|1-41  C|7|1-56  C|7a|1-56g  C|7b|1-56q  C|7c|1-56r  C|8|1-65z  C|8b|1-65hh  C|9|1-78  C|10|1-101rr  C|11|1-109  C|11a|1-119  C|12|1-134  C|13|1-140  C|13a|1-199  C|14|1-259  C|15|1-299  C|15a|1-329  C|15b|1-349  C|15c|1-499  C|15e|1-500  C|16|2-53n  C|17|2-62  C|18|2-71  C|18a|2-71z  C|19|2-79  C|19a|2-79d  C|19b|2-79i  C|20|2-80  C|21|2-84  C|22|2-88  C|23|2-99  C|23a|2-100  C|23b|2-109  C|23c|2-119  C|23d|2-120  C|23e|2-121  C|23f|2-122  C|23g|2-126  C|23h|2-134  C|23i|2-136  C|23j|2-137  C|28|2c-20  C|28a|2c-21  C|31|3-10f  C|32|3-76t  C|33|3-110r  C|34|3-123yyy  C|35|3-131  C|46|4-23  C|46a|4-23p  C|47|4-37v  C|48|4-61oo  C|49|4-64  C|50|4-124ww  C|51|4-137  C|51a|4-137h  C|52|4-140  C|53|4-165c  C|54|4-189g  C|54a|4-189j  C|55|4-204  C|55a|4-229  C|55b|4-249  C|55c|4-254  C|55d|4-273  C|55e|4-289  C|57|4a-18  C|57a|4a-24  C|57b|4a-49  C|58|4a-99  C|58a|4a-101  C|59|4b-50  C|60|4b-129  C|60a|4b-136  C|61|4d-79  C|61a|4d-89  C|61b|4d-99  C|61c|4d-100  C|62|4e-69  C|62a|4e-76  C|63|5-93b  C|64|5-141  C|64a|5-141e  C|65|5-151  C|66|5-192mm  C|66a|5-192nn  C|67|5-269  C|68|5-280  C|76|6-2b  C|77|6-28b  C|78|6-49a  C|79|6-76  C|90|7-9d  C|91|7-15  C|92|7-35z  C|92a|7-35gg  C|93|7-78  C|94|7-85  C|95|7-97  C|96|7-100j  C|96a|7-100z  C|97|7-147  C|97a|7-147y  C|98|7-186q  C|99|7-201  C|100|7-212a  C|101|7-233  C|101a|7-233hh  C|101b|7-233ii  C|102|7-244a  C|103|7-273a  C|103a|7-273z  C|103b|7-273pp  C|104|7-323v  C|105|7-339l  C|105a|7-339bb  C|105b|7-339kk  C|106|7-349  C|107|7-358  C|108|7-368  C|109|7-380c  C|110|7-390  C|111|7-397  C|112|7-406l  C|112a|7-406p  C|113|7-479  C|113a|7-479r  C|113b|7-479x  C|114|7-503  C|115|7-519  C|116|7-525  C|116a|7-534  C|116b|7-544  C|116c|7-559  C|117|7-599  C|124|8-13a  C|124a|8-13l  C|124b|8-13x  C|125|8-17  C|125a|8-17a  C|126|8-30f  C|126a|8-30j  C|127|8-37b  C|127a|8-37h  C|127b|8-37q  C|127c|8-37sss  C|128|8-119yy  C|129|8-123  C|130|8-169ss  C|131|8-185  C|132|8-200b  C|133|8-240j  C|133a|8-240s  C|134|8-265xx  C|135|8-282  C|136|8-289  C|137|8-299  C|137a|8-335  C|137b|8-336e  C|137c|8-336k  C|137d|8-336l  C|137e|8-336q  C|138|8-344  C|138a|8-354  C|138b|8-364  C|138c|8-369  C|138d|8-375  C|138e|8-383  C|138f|8-394  C|138g|8-399  C|138h|8-409  C|138i|8-414  C|138j|8-429  C|138k|8-439  C|138l|8-445  C|138m|8-450  C|141|9-8a  C|142|9-11  C|143|9-67  C|144|9-133  C|144a|9-133e  C|145|9-163k  C|146|9-237a  C|147|9-306  C|148|9-322b  C|149|9-332  C|150|9-348dd  C|150a|9-348gg  C|151|9-368c  C|152|9-371b  C|153|9-462  C|154|9-599  C|155|9-674  C|156|9-699  C|157|9-759  C|158|9-760  C|163|10-14d  C|163a|10-14h  C|163b|10-14l  C|163c|10-14ii  C|164|10-116s  C|165|10-144n  C|166|10-159a  C|167|10-183a  C|167a|10-183xx  C|168|10-202f  C|169|10-217j  C|170|10-239k  C|171|10-248c  C|172|10-281  C|172a|10-281gg  C|173|10-292v  C|174|10-311a  C|175|10-316a  C|176|10-320a  C|177|10-321g  C|177a|10-321p  C|177b|10-321v  C|177c|10-321cc  C|178|10-334h  C|179|10-357  C|179a|10-357g  C|180|10-368e  C|181|10-373z  C|181a|10-373bb  C|182|10-376  C|183|10-379  C|184|10-380  C|184a|10-391  C|184b|10-499  C|184c|10-531  C|185|10a-60  C|185a|10a-70  C|185b|10a-160  C|186|10a-175  C|187|10a-200  C|187a|10a-220  C|187b|10a-249  C|187c|10a-263  C|188|11-9d  C|188a|11-9f  C|189|11-19e  C|190|11-37  C|191|11-79  C|194|11-89  C|201|12-34e  C|202|12-39dd  C|203|12-121z  C|203a|12-121cc  C|204|12-170  C|204a|12-170dd  C|205|12-195h  C|206|12-200  C|207|12-212c  C|208|12-242z  C|208a|12-242dd  C|208b|12-242yy  C|209|12-248  C|210|12-255  C|210a|12-255t  C|211|12-263  C|211a|12-263l  C|211b|12-263o  C|211c|12-263zz  C|212|12-268  C|212a|12-268r  C|212b|12-268s  C|213|12-284a  C|213a|12-284b  C|214|12-330  C|214a|12-330dd  C|214b|12-330kk  C|214c|12-330nn  C|215|12-339b  C|216|12-390  C|216a|12-390e  C|217|12-399  C|218|12-405  C|218a|12-405m  C|219|12-432c  C|220|12-454  C|221|12-477b  C|222|12-493  C|222a|12-493a  C|223|12-504h  C|224|12-522a  C|225|12-556g  C|226|12-578bb  C|226a|12-582  C|226b|12-586e  C|226c|12-586g  C|227|12-609  C|228|12-630z  C|228a|12-638  C|228b|12-639  C|228c|12-649  C|228d|12-664  C|228e|12-674  C|228f|12-684  C|228g|12-691  C|228h|12-698  C|228z|12-699z  C|229|12-799  C|229a|12-849  C|229b|12-872  C|236|13a-13a  C|237|13a-35  C|238|13a-153g  C|239|13a-162b  C|240|13a-246  C|241|13a-268  C|242|13b-57c  C|242a|13b-57t  C|243|13b-79ll  C|244|13b-94a  C|244a|13b-100  C|244b|13b-115  C|244c|13b-126  C|244d|13b-198  C|245|13b-243  C|245a|13b-323  C|245b|13b-386  C|245c|13b-415  C|246|14-164a  C|246a|14-164z  C|246b|14-164aa  C|247|14-211  C|247a|14-211a  C|248|14-296bb  C|249|14-317  C|250|14-344  C|250a|14-344d  C|251|14-356  C|252|14-364  C|253|14-368  C|254|14-378  C|255|14-390m  C|256|14-399  C|263|15-26a  C|264|15-31  C|264a|15-31k  C|265|15-33  C|266|15-101j  C|266a|15-101z  C|266b|15-101ll  C|266c|15-101xx  C|267|15-120f  C|267a|15-120z  C|267b|15-120ss  C|268|15-200  C|269|15-232  C|277|16-50f  C|277a|16-50zz  C|277b|16-50bbb  C|278|16-75i  C|279|16-139a  C|280|16-190  C|281|16-215  C|282|16-227  C|283|16-262z  C|284|16-280h  C|285|16-308  C|286|16-317a  C|287|16-323  C|288|16-329  C|289|16-333p  C|290|16-338  C|291|16-341a  C|292|16-344  C|293|16-359  C|295|16a-16  C|296|16a-23l  C|296a|16a-23w  C|297|16a-35b  C|297a|16a-35j  C|298|16a-99  C|298a|16a-108  C|298b|16a-120  C|319|17a-89  C|319a|17a-209  C|319b|17a-269  C|319c|17a-299  C|319d|17a-339  C|319e|17a-359  C|319f|17a-389  C|319g|17a-404  C|319h|17a-449  C|319i|17a-620  C|319j|17a-749  C|319k|17a-760  C|319l|17a-899  C|319o|17b-59g  C|319q|17b-74  C|319s|17b-189  C|319t|17b-219  C|319v|17b-319  C|319x|17b-336  C|319y|17b-399  C|319aa|17b-419  C|319bb|17b-449  C|319dd|17b-489  C|319ff|17b-519  C|319hh|17b-549  C|319jj|17b-596  C|319mm|17b-679  C|319oo|17b-704  C|319pp|17b-729  C|319rr|17b-789  C|319tt|17b-799  C|319uu|17b-849  C|319ww|17b-884  C|319yy|17b-895  C|320|18-23  C|321|18-30  C|322|18-64  C|323|18-69e  C|324|18-77a  C|325|18-101k  C|326|18-104  C|327|18-107  C|368a|19a-134  C|368b|19a-144  C|368c|19a-174  C|368d|19a-199  C|368e|19a-239  C|368f|19a-249  C|368g|19a-268  C|368h|19a-269b  C|368i|19a-294  C|368j|19a-319  C|368k|19a-328  C|368l|19a-334  C|368m|19a-344  C|368n|19a-354  C|368o|19a-369  C|368p|19a-399  C|368q|19a-419  C|368r|19a-434  C|368s|19a-444  C|368t|19a-459  C|368u|19a-484  C|368v|19a-565c  C|368w|19a-580i  C|368x|19a-599  C|368y|19a-609  C|368z|19a-689  C|368aa|19a-692  C|368bb|19a-709  C|368cc|19a-749  C|368dd|19a-754k  C|368ee|19a-899  C|368ll|19a-915  C|369|20-7h  C|370|20-14s  C|371|20-23  C|372|20-33  C|373|20-42a  C|374|20-49  C|375|20-65e  C|375a|20-65m  C|376|20-74  C|376a|20-74n  C|376b|20-74z  C|376c|20-74uu  C|377|20-86i  C|378|20-102z  C|378a|20-102ff  C|379|20-126g  C|379a|20-126y  C|380|20-138d  C|381|20-162m  C|381a|20-162z  C|381b|20-162cc  C|382|20-185h  C|382a|20-185q  C|382b|20-185u  C|382c|20-185z  C|383|20-195  C|383a|20-195l  C|383b|20-195z  C|383c|20-195oo  C|383d|20-195zz  C|383e|20-195fff  C|383f|20-195lll  C|383g|20-195rrr  C|383h|20-195yyy  C|384|20-206  C|384a|20-206l  C|384b|20-206z  C|384c|20-206ii  C|384d|20-206oo  C|385|20-233  C|386|20-249  C|387|20-266m  C|387a|20-266s  C|388|20-278g  C|388a|20-278h  C|389|20-287  C|390|20-298c  C|391|20-310  C|392|20-329gg  C|393|20-341  C|393a|20-341r  C|393b|20-341ff  C|393c|20-341gg  C|394|20-357m  C|395|20-366  C|396|20-377j  C|396a|20-377v  C|397|20-395  C|397a|20-395h  C|398|20-407  C|399|20-417  C|399a|20-417z  C|399b|20-417aa  C|400|20-434  C|400a|20-449  C|400b|20-473  C|400c|20-483  C|400d|20-489  C|400f|20-499  C|400g|20-539  C|400h|20-552  C|400i|20-569  C|400j|20-639  C|400k|20-649  C|400l|20-659  C|400m|20-669  C|400o|20-690  C|400p|20-691  C|403|21-5a  C|404|21-8  C|405|21-14  C|406|21-26a  C|407|21-35  C|407a|21-35n  C|408|21-38  C|409|21-47m  C|409a|21-47v  C|410|21-48  C|411|21-63  C|412|21-84b  C|413|21-89  C|413a|21-99  C|414|21-110  C|414a|21-119  C|414b|21-121  C|416|21a-12g  C|417|21a-90  C|418|21a-125  C|419|21a-134  C|419a|21a-150j  C|419b|21a-164  C|419c|21a-174  C|419d|21a-194  C|419e|21a-215  C|420|21a-230  C|420a|21a-239  C|420b|21a-315  C|420c|21a-334  C|420d|21a-399  C|420e|21a-407  C|420f|21a-414  C|420g|21a-419  C|420h|21a-429  C|420l|21a-439  C|422|22-26z  C|422a|22-26qq  C|423|22-54u  C|424|22-61n  C|425|22-78a  C|426|22-104  C|427|22-111  C|427a|22-111z  C|427b|22-111yy  C|428|22-118  C|428a|22-118v  C|429|22-126a  C|430|22-203z  C|430a|22-203cc  C|431|22-265b  C|432|22-277a  C|433|22-321  C|434|22-326t  C|435|22-367a  C|436|22-380  C|436a|22-380m  C|437|22-391  C|438|22-409  C|438a|22-415j  C|438b|22-449  C|438c|22-454  C|438d|22-457  C|439|22a-27w  C|440|22a-45d  C|441|22a-66z  C|442|22a-76  C|443|22a-89  C|444|22a-113j  C|444a|22a-113t  C|445|22a-134z  C|445a|22a-134oo  C|445b|22a-134xx  C|446|22a-147  C|446a|22a-165h  C|446b|22a-169  C|446c|22a-206  C|446d|22a-256ee  C|446e|22a-292  C|446f|22a-307  C|446g|22a-313  C|446h|22a-335  C|446i|22a-400  C|446j|22a-415  C|446k|22a-599  C|446l|22a-611  C|446m|22a-628  C|446n|22a-900  C|446z|22a-905h  C|447|23-27k  C|447a|23-27q  C|448|23-32a  C|449|23-52  C|450|23-57  C|451|23-65e  C|451a|23-65q  C|452|23-72a  C|453|23-99  C|454|23-103  C|462|24-4  C|463|24-8  C|473|25-18  C|474|25-54  C|474a|25-54yy  C|475|25-66a  C|476|25-68a  C|476a|25-68o  C|477|25-102  C|477a|25-102s  C|477b|25-102z  C|477c|25-102oo  C|477d|25-102xx  C|478|25-109b  C|478a|25-109p  C|478b|25-109q  C|479|25-119  C|480|25-121  C|481|25-125  C|482|25-137  C|483|25-159  C|483a|25-169  C|483b|25-174  C|483c|25-198  C|483aa|25-199c  C|484|25-229  C|485|25-238  C|490|26-186a  C|491|26-237e  C|492|26-294  C|493|26-301  C|494|26-302  C|495|26-317  C|504|27-100g  C|505|27-102  C|505a|27-102k  C|506|27-140ii  C|507|27-274  C|517|28-22  C|517a|28-22c  C|517b|28-22d  C|518|28-23a  C|518a|28-30f  C|518b|28-31  C|518c|28-32a  C|528|29-1yy  C|529|29-38p  C|530|29-108  C|530a|29-108i  C|531|29-128f  C|532|29-143h  C|532a|29-143aa  C|533|29-152d  C|533a|29-152t  C|534|29-161aa  C|535|29-164e  C|535a|29-164g  C|536|29-179i  C|537|29-190  C|538|29-200  C|538a|29-220  C|539|29-230  C|540|29-249  C|541|29-449  C|541a|29-453a  C|545|30-118  C|556|31-11k  C|556a|31-11uu  C|557|31-57aa  C|558|31-76o  C|559|31-90a  C|560|31-100  C|561|31-111b  C|562|31-121a  C|563|31-128  C|563a|31-128j  C|564|31-134a  C|565|31-138  C|566|31-221  C|566a|31-221h  C|567|31-274j  C|568|31-355b  C|569|31-362  C|569a|31-362g  C|570|31-366  C|571|31-385  C|572|31-395  C|573|31-409  C|574|31-429  C|577|31-901a  C|578|32-9zz  C|579|32-23zz  C|580|32-31  C|580a|32-31a  C|581|32-47a  C|582|32-55i  C|583|32-59  C|583a|32-59a  C|584|32-69  C|585|32-80c  C|586|32-85  C|587|32-95  C|588|32-109  C|588a|32-129  C|588b|32-139  C|588c|32-149  C|588d|32-155  C|588e|32-159  C|588f|32-169  C|588g|32-174  C|588h|32-179  C|588i|32-184  C|588j|32-199  C|588k|32-219  C|588l|32-244a  C|588m|32-259  C|588n|32-299  C|588o|32-314  C|588p|32-324h  C|588q|32-339  C|588r|32-379  C|588s|32-424  C|588t|32-449  C|588u|32-499  C|588v|32-529  C|588w|32-599  C|588x|32-619  C|588y|32-649  C|588z|32-699  C|588aa|32-709  C|588bb|32-715  C|588cc|32-724  C|588dd|32-729  C|588ee|32-740  C|588ff|32-759  C|588gg|32-776  C|589|33-11  C|590|33-144  C|591|33-156b  C|592|33-167  C|593|33-179  C|593a|33-179u  C|594|33-182  C|594a|33-182z  C|594b|33-182ff  C|595|33-193  C|596|33-217  C|597|33-242  C|598|33-281a  C|598a|33-281c  C|599|33-418e  C|599a|33-418o  C|600|33-599  C|601|33-999  C|602|33-1330  C|603|33-1349  C|604|33-1999  C|608|33-2001  C|609|34-8  C|610|34-38u  C|611|34-81z  C|612|34-99  C|613|34-242  C|613a|34-299  C|614|34-499  C|615|34-599  C|616|34-646  C|620|35-3  C|620a|35-3c  C|621|35-11  C|621a|35-11m  C|622|35-18  C|622a|35-18j  C|623|35-23  C|624|35-49  C|625|35-58  C|673|37-10  C|707|40-1  C|708|40-59  C|709|40-80  C|720|41-53  C|731|42-76  C|732|42-82  C|733|42-100a  C|733a|42-100c  C|734|42-103  C|734a|42-103v  C|734b|42-103ddd  C|735|42-110  C|735a|42-110q  C|735b|42-110z  C|735c|42-110ll  C|736|42-115u  C|737|42-116j  C|737a|42-116o  C|737b|42-116r  C|737c|42-116z  C|737d|42-116aa  C|738|42-125  C|738a|42-125z  C|738b|42-125cc  C|739|42-133mm  C|740|42-143  C|741|42-150t  C|741c|42-150z  C|741d|42-150bb  C|742|42-158  C|742a|42-158h  C|742b|42-158z  C|742c|42-158aa  C|743|42-169  C|743a|42-178  C|743b|42-199  C|743c|42-209  C|743d|42-214  C|743e|42-219  C|743f|42-226a  C|743g|42-229  C|743h|42-239  C|743i|42-259  C|743j|42-269  C|743k|42-279  C|743l|42-283  C|743m|42-294  C|743n|42-309  C|743o|42-319  C|743p|42-329  C|743q|42-344  C|743r|42-354  C|743s|42-359  C|743t|42-369  C|743u|42-389  C|743aa|42-449  C|743bb|42-459  C|743cc|42-469  C|743dd|42-479  C|743ee|42-480  C|743ff|42-489  C|743gg|42-499  C|743hh|42-510  C|743ii|42-514  C|743jj|42-530  C|747|42-901  A|1|42a-1-310  A|2|42a-2-725  A|2A|42a-2A-737  A|3|42a-3-805  A|4|42a-4-504  A|4A|42a-4A-507  A|5|42a-5-119  A|6|42a-6-110b  A|7|42a-7-704  A|8|42a-8-601  A|9|42a-9-809  A|10|42a-10-109  C|748|42b-15  C|750|43-9  C|751|43-16q  C|752|43-45  C|753|43-52  C|763|44-5  C|801|45a-97  C|801a|45a-104  C|801b|45a-198  C|802|45a-249  C|802a|45a-272  C|802b|45a-470  C|802c|45a-545  C|802d|45a-561  C|802e|45a-567  C|802f|45a-577  C|802g|45a-590  C|802h|45a-705a  C|803|45a-770  C|803a|45a-788  C|812|46a-6  C|813|46a-13a  C|813a|46a-13s  C|814|46a-26  C|814a|46a-40  C|814b|46a-50  C|814c|46a-125  C|814d|46a-149  C|814e|46a-169  C|814f|46a-170  C|815|46b-14  C|815a|46b-19  C|815e|46b-38z  C|815f|46b-39  C|815j|46b-89  C|815o|46b-114  C|815p|46b-119  C|815t|46b-159  C|815y|46b-179d  C|816|46b-300  C|817|46b-425  C|818|46b-580  C|821|47-36  C|821a|47-36z  C|821b|47-36bb  C|822|47-42f  C|823|47-56  C|824|47-66j  C|825|47-90h  C|826|47-115  C|827|47-199  C|828|47-299  C|828a|47-304  C|830|47a-20f  C|831|47a-22a  C|832|47a-42a  C|833|47a-49  C|833a|47a-67  C|834|47a-75  C|830|47a-20f  C|831|47a-22a  C|832|47a-42a  C|833|47a-49  C|833a|47a-67  C|834|47a-75  C|835|48-57  C|846|49-31v  C|847|49-92z  C|848|49-115  C|859|50-14  C|860|50a-29  C|861|50a-49  C|861a|50a-99  C|862|50a-139  C|862a|50a-199  C|863|50a-203  C|870|51-26  C|871|51-38  C|872|51-51f  C|872a|51-51u  C|873|51-59  C|874|51-74  C|875|51-79  C|876|51-94a  C|877|51-110  C|878|51-126  C|879|51-138  C|880|51-141  C|881|51-164i  C|881a|51-164l  C|881b|51-164r  C|882|51-197f  C|883|51-211  C|883a|51-216  C|883b|51-216c  C|884|51-247c  C|885|51-274  C|886|51-288  C|887|51-300  C|888|51-329  C|889|51-341  C|890|51-353b  C|895|52-45  C|896|52-72  C|897|52-88  C|898|52-142  C|899|52-184e  C|900|52-235f  C|901|52-262  C|902|52-269  C|903|52-278  C|903a|52-278n  C|904|52-328  C|905|52-346  C|906|52-400f  C|907|52-405  C|908|52-407  C|909|52-424  C|910|52-434d  C|911|52-445  C|912|52-455  C|913|52-461  C|914|52-465  C|915|52-470  C|916|52-483  C|917|52-484  C|918|52-494  C|919|52-503r  C|920|52-514  C|921|52-531  C|922|52-549  C|922a|52-549m  C|922b|52-549aa  C|923|52-551  C|923a|52-552l  C|924|52-554  C|925|52-572x  C|926|52-598a  C|927|52-603  C|928|52-609  C|929|52-618  C|930|52-654  C|931|52-660  C|938|53-8  C|939|53-41b  C|940|53-55  C|941|53-142k  C|942|53-168  C|943|53-215a  C|944|53-241  C|945|53-254  C|946|53-345a  C|947|53-353  C|948|53-379b  C|949|53-388a  C|949a|53-392  C|949b|53-392e  C|949c|53-419  C|949d|53-439  C|949e|53-449  C|949f|53-450  C|949g|53-454  C|950|53a-3  C|951|53a-23  C|952|53a-323  C|959|54-41  C|959a|54-41u  C|960|54-76a  C|960a|54-76q  C|961|54-142  C|961a|54-142s  C|962|54-155  C|963|54-156  C|964|54-185  C|965|54-192h  C|966|54-193b  C|967|54-200  C|968|54-239  C|968a|54-249  C|969|54-279  C|969a|54-299  C|970|54-301  C|978|55-4`
  .split('  ').map(s => s.split('|')).map(([a, b, c]) => ({ChapterType: a, ChapterNumber: b, LastSection: c}))

const group = (s) => 
  [...s].reduce(
    ({groups, curr}, c) => 
      c.match(/[a-z]/i)
        ? curr.type === 'alpha'
          ? (curr.vals.push(c), {groups, curr})
          : (curr = {type: 'alpha', vals: [c]}, groups.push(curr), {groups, curr})
      : c.match(/[0-9]/)
        ? curr.type === 'digits'
          ? (curr.vals.push(c), {groups, curr})
          : (curr = {type: 'digits', vals: [c]}, groups.push(curr), {groups, curr})
      : curr.type == 'punc'
        ? (curr.vals.push(c), {groups, curr})
        : (curr = {type: 'punc', vals: [c]}, groups.push(curr), {groups, curr})
    ,
    {groups: [], curr: [{type: 'none'}]}
  )
  .groups
  .map(({type, vals}) => ({type, val: vals.join('')}))
  .map(({type, val}) => ({type, val: type == 'digits' ? Number(val) : val}))

const compareGroups = (
  [a1 = undefined, ...as], [b1 = undefined, ...bs], 
  at = (a1 || {}).type,  bt = (b1 || {}).type,
  av = (a1 || {}).val, bv = (b1 || {}).val
) => 
  (a1 == undefined && b1 == undefined) 
    ? 0
  : (a1 == undefined)
    ? -1
  : (b1 == undefined)
    ? 1
  : (at == 'punc' && bt == 'punc') 
      ? av < bv ? -1 : av > bv ? 1 : compareGroups(as, bs) // or should we get 'a_b' = 'a-b'? using:
  //  ? compareGroups(as, bs)  
  : (at == 'punc')
    ? -1
  : (at == 'digits' && bt == 'digits') 
    ? av < bv ? -1 : av > bv ? 1 : compareGroups(as, bs)
  : (at == 'digits')
    ? 1
  : (at == 'alpha' && bt == 'alpha')
    ? av.length < bv.length ? -1 : av.length > bv.length ? 1 : av < bv ? -1 : av > bv ? 1 : compareGroups(as, bs)
  : 1

const compare = (a, b) =>
  compareGroups(group(a), group(b))

const makeArticleNbr = ([...nbr]) => 
  nbr.filter(c => c.match(/\d/)).join('').padStart(3, '0') + 
  nbr.filter(c => !c.match(/\d/)).join('').toLowerCase()

const cgsUrl = (section) => {
  const chapter = chapters.find(({LastSection}) => compare(section, LastSection) <= 0)
  return chapter ? `https://www.cga.ct.gov/current/pub/${
    chapter.ChapterType == "A" 
      ? 'art_' + makeArticleNbr(chapter.ChapterNumber) 
      : `chap_${chapter.ChapterNumber}`
    }.htm#sec_${section}` : null
}

exports.name = "cgs";

exports.params = [
	{name: "section"},
  {name: "text"}
];

/*
Run the macro
*/
exports.run = function(section, text="") {
	const url = cgsUrl(section)
	return url ? `<a class="cgs" href="${url}">${text || section}</a>` : section
};

})();
